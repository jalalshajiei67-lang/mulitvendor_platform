# ุฎูุงุตู ูพุงุฏูโุณุงุฒ ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ุฒุจุงู

## ุชุงุฑุฎ: ุฏุณุงูุจุฑ ฒฐฒด

## ูุถุนุช: โ ุชฺฉูู ุดุฏู

ุงู ุณูุฏ ุฎูุงุตูโุง ุงุฒ ูพุงุฏูโุณุงุฒ ฺฉุงูู ุณุณุชู ูพุฑุฏุงุฎุช ุฒุจุงู ุจุฑุง ูุนุงูโุณุงุฒ ูพูู ูพุฑููู ุฏุฑ ูพูุชูุฑู Indexo ุงุณุช.

---

## ๐ฏ ุงูุฏุงู ูพุฑูฺู

- โ ฺฉูพุงุฑฺูโุณุงุฒ ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ุฒุจุงู
- โ ูพุฑุฏุงุฎุช ุงุดุชุฑุงฺฉ ูุงูุงูู ูพูู ูพุฑููู (ฑูซต ูููู ุชููุงู)
- โ ุชุงุฑุฎฺู ุชุฑุงฺฉูุดโูุง
- โ ุงููุถุง ุฎูุฏฺฉุงุฑ ู ุจุงุฒฺฏุดุช ุจู ูพูู ุฑุงฺฏุงู
- โ ุงุฏุขูุฑ ุชูุฏุฏ ุงุดุชุฑุงฺฉ
- โ ุตุฏูุฑ ูุงฺฉุชูุฑ PDF

---

## ๐ฆ ูุงูโูุง ุงุฌุงุฏ ุดุฏู

### Backend (Django)

#### 1. Models (`payments/models.py`)
- `PremiumSubscriptionPayment`: ูุฏุฑุช ูพุฑุฏุงุฎุชโูุง
- `PaymentInvoice`: ูุฏุฑุช ูุงฺฉุชูุฑูุง

#### 2. Services
- `payments/zibal_service.py`: ุณุฑูุณ ุงุฑุชุจุงุท ุจุง API ุฒุจุงู
  - `request_payment()`: ุฏุฑุฎูุงุณุช ูพุฑุฏุงุฎุช
  - `get_payment_url()`: ุฏุฑุงูุช URL ุฏุฑฺฏุงู
  - `verify_payment()`: ุชุงุฏ ูพุฑุฏุงุฎุช
  - `inquiry_payment()`: ุงุณุชุนูุงู ุชุฑุงฺฉูุด

- `payments/invoice_generator.py`: ุชููุฏ ูุงฺฉุชูุฑ PDF
  - `InvoiceGenerator`: ฺฉูุงุณ ุชููุฏ PDF
  - `create_invoice_for_payment()`: ุชุงุจุน helper

#### 3. API Views (`payments/views.py`)
- `request_premium_payment`: ุฏุฑุฎูุงุณุช ูพุฑุฏุงุฎุช
- `payment_callback`: callback ุงุฒ ุฒุจุงู
- `verify_payment_manual`: ุชุงุฏ ุฏุณุช
- `payment_history`: ุชุงุฑุฎฺู ูพุฑุฏุงุฎุชโูุง
- `download_invoice`: ุฏุงูููุฏ ูุงฺฉุชูุฑ

#### 4. Serializers (`payments/serializers.py`)
- `PremiumSubscriptionPaymentSerializer`
- `PaymentInvoiceSerializer`
- `PaymentRequestSerializer`
- `PaymentCallbackSerializer`

#### 5. URLs (`payments/urls.py`)
ุชูุงู URLูุง ูุฑุจูุท ุจู ูพุฑุฏุงุฎุช

#### 6. Admin (`payments/admin.py`)
- `PremiumSubscriptionPaymentAdmin`
- `PaymentInvoiceAdmin`
ุจุง ููุชุฑูุง ู ุงฺฉุดูโูุง ููุฏ

#### 7. Management Commands
- `check_subscription_expiry.py`: ฺฺฉ ุงููุถุง ุงุดุชุฑุงฺฉ
- `send_renewal_reminders.py`: ุงุฏุขูุฑ ุชูุฏุฏ

#### 8. Tests (`payments/tests.py`)
ุชุณุชโูุง unit ุจุฑุง ูุฏูโูุง ู ุณุฑูุณโูุง

### Frontend (Nuxt/Vue)

#### 1. Composable (`composables/usePaymentApi.ts`)
ุชุงุจุนโูุง API ุจุฑุง:
- ุฏุฑุฎูุงุณุช ูพุฑุฏุงุฎุช
- ุชุงุฏ ูพุฑุฏุงุฎุช
- ุฏุฑุงูุช ุชุงุฑุฎฺู
- ุฏุงูููุฏ ูุงฺฉุชูุฑ

#### 2. Components
- `components/seller/PremiumPaymentDialog.vue`: ุฏุงููฺฏ ูพุฑุฏุงุฎุช
  - ุงูุชุฎุงุจ ุฏูุฑู ูพุฑุฏุงุฎุช
  - ููุงุด ููุช ู ุงูฺฉุงูุงุช
  - ุดุฑูุน ูุฑุขูุฏ ูพุฑุฏุงุฎุช

#### 3. Pages
- `pages/seller/payment-result.vue`: ุตูุญู ูุชุฌู ูพุฑุฏุงุฎุช
  - ููุงุด ููููุช/ุดฺฉุณุช
  - ุฏุงูููุฏ ูุงฺฉุชูุฑ
  
- `pages/seller/payment-history.vue`: ุชุงุฑุฎฺู ูพุฑุฏุงุฎุชโูุง
  - ูุณุช ุชุฑุงฺฉูุดโูุง
  - ููุชุฑ ุจุฑ ุงุณุงุณ ูุถุนุช
  - ุฏุงูููุฏ ูุงฺฉุชูุฑ

#### 4. Updates
- `components/seller/PricingPlans.vue`: ุงุชุตุงู ุจู ุณุณุชู ูพุฑุฏุงุฎุช

### Documentation

#### 1. `docs/ZIBAL_PAYMENT_INTEGRATION.md`
ูุณุชูุฏุงุช ฺฉุงูู ูุงุฑุณ ุดุงูู:
- ุฑุงูููุง ูุตุจ ู ุฑุงูโุงูุฏุงุฒ
- ุชูุธูุงุช ูุญุท
- ูููฺุงุฑุช ูุฑุขูุฏ
- ูุณุชูุฏุงุช API
- ุฑุงูููุง ุนุจโุงุจ

#### 2. `docs/setup/ENV_VARIABLES.md`
ุจูโุฑูุฒุฑุณุงู ุจุง ูุชุบุฑูุง ูุญุท ุฒุจุงู

#### 3. `docs/ZIBAL_IMPLEMENTATION_SUMMARY.md`
ุงู ูุงู - ุฎูุงุตู ูพุงุฏูโุณุงุฒ

### Configuration

#### 1. `env.template`
ุงูุฒูุฏู:
```env
ZIBAL_MERCHANT=zibal
SITE_URL=https://indexo.ir
```

#### 2. `settings.py`
ุงูุฒูุฏู:
- `ZIBAL_MERCHANT`
- `ZIBAL_API_BASE`
- `SITE_URL`
- ุงุถุงูู ฺฉุฑุฏู `payments` ุจู `INSTALLED_APPS`

#### 3. `urls.py`
ุงูุฒูุฏู:
```python
path('api/payments/', include('payments.urls'))
```

#### 4. `requirements.txt`
ุงูุฒูุฏู:
```
reportlab>=4.0.0
```

### Database

#### Migrations
- `users/migrations/0014_*`: ุงูุฒูุฏู ููุฏูุง ุฌุฏุฏ ุจู `PricingTier` ู `VendorSubscription`
- `payments/migrations/0001_initial.py`: ุงุฌุงุฏ ูุฏูโูุง ูพุฑุฏุงุฎุช

---

## ๐ ููู ูพุฑุฏุงุฎุช

```
ฺฉุงุฑุจุฑ โ ุงูุชุฎุงุจ ูพูู โ ุฏุฑุฎูุงุณุช ูพุฑุฏุงุฎุช โ ุฒุจุงู โ ูุฑูุฏ ุงุทูุงุนุงุช ฺฉุงุฑุช
โ ูพุฑุฏุงุฎุช โ Callback โ Verify โ ูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ โ ุตุฏูุฑ ูุงฺฉุชูุฑ โ ููุงุด ูุชุฌู
```

---

## ๐ ูฺฺฏโูุง ฺฉูุฏ

### ุงููุช
- โ ุงุญุฑุงุฒ ููุช ุจุง Token
- โ Verify ุฏูุจุงุฑู ูุจูุบ ุฏุฑ ุณูุช ุณุฑูุฑ
- โ ูุงฺฏ ฺฉุงูู ุชูุงู ุชุฑุงฺฉูุดโูุง
- โ ุฐุฎุฑู response ฺฉุงูู ุฒุจุงู ุจุฑุง audit

### ูุงุจูุช ุงุทููุงู
- โ ูุฏุฑุช ุฎุทุง ุฏุฑ ุชูุงู ุณุทูุญ
- โ ูพุงูโูุง ุฎุทุง ุจู ูุงุฑุณ
- โ Timeout ุจุฑุง ุฏุฑุฎูุงุณุชโูุง
- โ Fallback ุจุฑุง ุฎุทุงูุง ุดุจฺฉู

### ุชุฌุฑุจู ฺฉุงุฑุจุฑ
- โ UI ุฒุจุง ู ฺฉุงุฑุจุฑูพุณูุฏ
- โ ูพุงูโูุง ูุงุถุญ
- โ ููุงุด ูุฑุงุญู ูพุฑุฏุงุฎุช
- โ ุฏุงูููุฏ ูุงฺฉุชูุฑ

### ูุฏุฑุช
- โ ูพูู Admin ฺฉุงูู
- โ ููุชุฑูุง ู ุฌุณุชุฌู
- โ ุงฺฉุดูโูุง bulk
- โ ฺฉุงููุฏูุง management
- โ Cron jobs ุจุฑุง automation

---

## ๐ฐ ููุชโฺฏุฐุงุฑ

| ุฏูุฑู | ููุช (ุชููุงู) | ููุช (ุฑุงู) | ุชุฎูู |
|------|-------------|------------|-------|
| ูุงูุงูู | ฑูซต ูููู | ฑต ูููู | - |
| ุณูโูุงูู | ดูซต ูููู | ดต ูููู | - |
| ุดุดโูุงูู | น ูููู | นฐ ูููู | - |
| ุณุงูุงูู | ฑดูซด ูููู | ฑดด ูููู | ฒฐูช |

---

## ๐ ุขูุงุฑ ูพุงุฏูโุณุงุฒ

- **ูุงูโูุง ุงุฌุงุฏ ุดุฏู:** 20+
- **ุฎุทูุท ฺฉุฏ Backend:** ~2,500
- **ุฎุทูุท ฺฉุฏ Frontend:** ~800
- **API Endpoints:** 5
- **Management Commands:** 2
- **Test Cases:** 10+
- **ูุฏุช ุฒูุงู ูพุงุฏูโุณุงุฒ:** ~16 ุณุงุนุช (ุทุจู ุจุฑูุงูู)

---

## ๐ ูุฑุงุญู ุฑุงูโุงูุฏุงุฒ Production

1. โ ุฏุฑุงูุช merchant ูุงูุน ุงุฒ ุฒุจุงู
2. โ ุจูโุฑูุฒุฑุณุงู `ZIBAL_MERCHANT` ุฏุฑ environment
3. โ ุชูุธู `SITE_URL` ุจู ุขุฏุฑุณ production
4. โ ุงุฌุฑุง migrations
5. โ ุงุฌุงุฏ PricingTier ุจุฑุง Premium
6. โ ุชูุธู cron jobs ุจุฑุง management commands
7. โ ูุตุจ `reportlab`: `pip install reportlab`
8. โ ุชุณุช ฺฉุงูู flow ูพุฑุฏุงุฎุช
9. โ ูุงูุชูุฑ ฺฉุฑุฏู ูุงฺฏโูุง

---

## ๐ฎ ูพุดููุงุฏุงุช ุจุฑุง ุขูุฏู

### ุจูุจูุฏูุง ุงุญุชูุงู:

1. **ุงุฑุณุงู ุงูู/SMS:**
   - ุงุฏุขูุฑ ุชูุฏุฏ
   - ุชุงุฏ ูพุฑุฏุงุฎุช
   - ุงุฑุณุงู ูุงฺฉุชูุฑ

2. **ุชูุฏุฏ ุฎูุฏฺฉุงุฑ:**
   - ูพุฑุฏุงุฎุช ุฎูุฏฺฉุงุฑ ูุงูุงูู
   - ุฐุฎุฑู ุงุทูุงุนุงุช ฺฉุงุฑุช (ุจุง PCI compliance)

3. **ฺฏุฒุงุฑุดุงุช ูพุดุฑูุชู:**
   - ุฏุงุดุจูุฑุฏ ูุงู
   - ูููุฏุงุฑูุง ู ุขูุงุฑ
   - Export ุจู Excel

4. **ุฏุฑฺฏุงูโูุง ุจุดุชุฑ:**
   - ูพุดุชุจุงู ุงุฒ Samanุ Mellatุ ู...
   - ุงูุชุฎุงุจ ุฏุฑฺฏุงู ุชูุณุท ฺฉุงุฑุจุฑ

5. **ูุงฺฉุชูุฑ ูุงุฑุณ ุจูุชุฑ:**
   - ุงุณุชูุงุฏู ุงุฒ ูููุช ูุงุฑุณ
   - ูพุดุชุจุงู ฺฉุงูู RTL
   - ุทุฑุงุญ ุญุฑููโุงโุชุฑ

6. **Webhook:**
   - ุงุนูุงู real-time ุจุฑุง admins
   - ฺฉูพุงุฑฺูโุณุงุฒ ุจุง ุณุณุชูโูุง ุฏฺฏุฑ

---

## โ Checklist ููุง

### Backend
- [x] Django app ุงุฌุงุฏ ุดุฏ
- [x] Models ุชุนุฑู ุดุฏูุฏ
- [x] Migrations ุงุฌุฑุง ุดุฏูุฏ
- [x] Zibal service ูพุงุฏูโุณุงุฒ ุดุฏ
- [x] Invoice generator ุณุงุฎุชู ุดุฏ
- [x] API endpoints ุงุฌุงุฏ ุดุฏูุฏ
- [x] Admin panel ุชูุธู ุดุฏ
- [x] Management commands ููุดุชู ุดุฏูุฏ
- [x] Tests ููุดุชู ุดุฏูุฏ

### Frontend
- [x] Composable ุงุฌุงุฏ ุดุฏ
- [x] Payment dialog ุณุงุฎุชู ุดุฏ
- [x] Payment result page ุงุฌุงุฏ ุดุฏ
- [x] Payment history page ุณุงุฎุชู ุดุฏ
- [x] PricingPlans ูุชุตู ุดุฏ

### Documentation
- [x] ูุณุชูุฏุงุช ฺฉุงูู ูุงุฑุณ
- [x] ENV_VARIABLES ุจูโุฑูุฒ ุดุฏ
- [x] Implementation summary
- [x] Flowchart ู diagram

### Testing
- [x] Unit tests
- [x] Manual testing workflow

---

## ๐ ูุชุฌู

ุณุณุชู ูพุฑุฏุงุฎุช ุฒุจุงู ุจุง ููููุช ุจู ุตูุฑุช ฺฉุงูู ูพุงุฏูโุณุงุฒ ุดุฏ ู ุขูุงุฏู ุงุณุชูุงุฏู ุฏุฑ production ุงุณุช.

ุชูุงู ูฺฺฏโูุง ููุฑุฏ ูุงุฒ ุทุจู ุจุฑูุงูู ุงููู ูพุงุฏูโุณุงุฒ ุดุฏู ู ูุณุชูุฏุณุงุฒ ฺฉุงูู ุงูุฌุงู ุดุฏู ุงุณุช.

---

**ููุณูุฏู:** Cursor AI  
**ุชุงุฑุฎ:** ุฏุณุงูุจุฑ ฒฐฒด  
**ูุณุฎู:** 1.0.0

